<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jeremie Koenig" />
  <meta name="author" content="Zhong Shao" />
  <meta name="dcterms.date" content="2021-03-04" />
  <title>CompCertO: Compiling Certified Open Components</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">



div#header, header
{

border-bottom: 1px solid #aaa;
margin-bottom: 0.5em;
}
.title 
{
text-align: center;
}
.author, .date 
{
text-align: center;
}

div#TOC, nav#TOC
{

border-bottom: 1px solid #aaa;
margin-bottom: 0.5em;
}
@media print
{
div#TOC, nav#TOC
{

display: none;
}
}

h1, h2, h3, h4, h5, h6
{
font-family: "Helvetica Neue", Helvetica, "Liberation Sans", Calibri, Arial, sans-serif; 

page-break-after: avoid; 
}

div div, section section 
{
margin-left: 2em; 
}
p {}
blockquote
{ font-style: italic;
}
li 
{
}
li > p 
{
margin-top: 1em; 
}
ul 
{
}
ul li 
{
}
ol 
{
}
ol li 
{
}
hr {}

sub 
{
}
sup 
{
}
em 
{
}
em > em 
{
font-style: normal;
}
strong 
{
}

a 
{

text-decoration: none;
}
@media screen
{
a:hover
{

text-decoration: underline;
}
}
@media print
{
a {

color: black;
background: transparent;
}
a[href^="http://"]:after, a[href^="https://"]:after
{

content: " (" attr(href) ") ";
font-size: 90%;
}
}

img
{

vertical-align: middle;
}
div.figure 
{

margin-left: auto;
margin-right: auto;
text-align: center;
font-style: italic;
}
p.caption 
{

}

pre, code {
background-color: #fdf7ee;



white-space: pre-wrap; 
white-space: -moz-pre-wrap !important; 
white-space: -pre-wrap; 
white-space: -o-pre-wrap; 
word-wrap: break-word; 

}
pre 
{

padding: 0.5em; 
border-radius: 5px; 

border: 1px solid #aaa;

margin-left: 0.5em;
margin-right: 0.5em;
}
@media screen
{
pre
{

white-space: pre;
overflow: auto;

border: 1px dotted #777;
}
}
code 
{
}
p > code, li > code 
{

padding-left: 2px;
padding-right: 2px;
}
li > p code 
{

padding: 2px;
}

span.math 
{

}
div.math 
{
}
span.LaTeX 
{
} eq 
{
} 

table
{
border-collapse: collapse;
border-spacing: 0; 
border-bottom: 2pt solid #000;
border-top: 2pt solid #000; 

margin-left: auto;
margin-right: auto;
}
thead 
{
border-bottom: 1pt solid #000;
background-color: #eee; 
}
tr.header 
{
} tbody 
{
}

tr {
}
tr.odd:hover, tr.even:hover 
{
background-color: #eee;
}

tr.odd {}
tr.even {}
td, th 
{ vertical-align: top; 
vertical-align: baseline; 
padding-left: 0.5em;
padding-right: 0.5em;
padding-top: 0.2em;
padding-bottom: 0.2em;
}


th 
{
font-weight: bold; }
tfoot 
{
}
caption 
{
caption-side: top;
border: none;
font-size: 0.9em;
font-style: italic;
text-align: center;
margin-bottom: 0.3em; 
padding-bottom: 0.2em;
}

dl 
{
border-top: 2pt solid black;
padding-top: 0.5em;
border-bottom: 2pt solid black;
}
dt 
{
font-weight: bold;
}
dd+dt 
{
border-top: 1pt solid black;
padding-top: 0.5em;
}
dd 
{
margin-bottom: 0.5em;
}
dd+dd 
{
border-top: 1px solid black; 
}

a.footnote, a.footnoteRef { 
font-size: small; vertical-align: text-top;
}
a[href^="#fnref"], a.reversefootnote 
{
}
@media print
{
a[href^="#fnref"], a.reversefootnote 
{

display: none;
}
}
div.footnotes 
{
}
div.footnotes li[id^="fn"] 
{
}

@media print
{
.noprint
{
display:none;
}
}
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">CompCertO: Compiling Certified Open Components</h1>
<p class="author">Jeremie Koenig</p>
<p class="author">Zhong Shao</p>
<p class="date">March 4, 2021</p>
</header>
<p>Our artifact is a version of the certified compiler CompCert, designed to be used as a component in other software verification efforts. Evaluating the artifact should mostly consist in checking that the definitions and proofs in the Coq code corresponds to their high-level description given in the paper.</p>
<hr />
<h2 id="getting-started">Getting started</h2>
<p>There are two possible ways to proceed: build CompCertO from scratch in you own Linux environment, or use the virtual machine image we provide.</p>
<h3 id="quick-links">Quick links</h3>
<ul>
<li>Browse the development: <a href="https://certikos.github.io/compcert/doc/">online</a> | <a href="file:///home/aec/compcerto-prebuilt/doc/index.html">vm</a></li>
<li>CompCertO release: <a href="https://certikos.github.io/compcert/compcerto-0.1.tar.bz2">online</a> | <a href="file:///home/aec/compcerto-0.1.tar.bz2">vm</a> (MD5: 68da74fe23be11350358beb943d53ef1)</li>
<li>VirtualBox image: <a href="https://drive.google.com/drive/folders/1imN-V7trdxEGZODyhIJJxxjiRVEYrDWB">online</a></li>
</ul>
<h3 id="building-in-your-own-environment">Building in your own environment</h3>
<p>Our development has been packaged into a <code>compcerto-0.1.tar.bz2</code> archive. Build instructions can be found in the <code>README.md</code> file. In particular, they describe how to use <code>opam</code> to set up a temporary build environment with tested versions of the dependencies, under you user account.</p>
<p>If you would prefer to use your own Linux environment and a lighter download, the standalone tarball can be downloaded using the link above. Otherwise, we recommend you download the virtual machine image we provided in HotCRP, which includes <code>compcerto-0.1.tar.bz2</code> in its file system.</p>
<h3 id="using-our-virtual-machine-image">Using our virtual machine image</h3>
<p>The file <code>CompCertO.ova</code> submitted as our artifact is a virtual machine image containing a standard installation of Debian GNU/Linux where an appropriate build environment for CompCertO has been set up. The image is designed for use with <a href="https://www.virtualbox.org/">VirtualBox 6.1</a>.</p>
<p>In VirtualBox, choose “File &gt; Import Appliance” to import the image, then start the new virtual machine. Log in with:</p>
<ul>
<li>Username: aec</li>
<li>Password: pldi21</li>
</ul>
<p>By clicking “Activities” in the upper right corner, you will be able to open a terminal or run applications like Firefox and CoqIDE. In particular, an HTML version of this document has been set as the Firefox start page.</p>
<p>The home directory <code>/home/aec</code> contains a copy of <code>compcerto-0.1.tar.bz2</code>. It can be extracted as usual with the following command:</p>
<pre><code>$ tar -jxf compcerto-0.1.tar.bz2</code></pre>
<p>You may then follow the instructions in <code>compcerto/README.md</code>. Note that an appropriate <code>opam</code> environment has already been set up for you.</p>
<p>Alternatively, we have provided a pre-built version of CompCertO under the <code>compcerto-prebuilt/</code> directory. This will allow you to immediately browse the generated documentation (which has been set as the Firefox home page), and replay any proof within CoqIDE.</p>
<h3 id="browsing-the-development">Browsing the development</h3>
<p>We recommend browsing the code using the generated coqdoc-style HTML pages (see links at the beginning of this document). They will end up in the <code>doc/html/</code> subdirectory after they are built using <code>make documentation</code>. The file <code>doc/index.html</code> provides an overview of CompCert and table of contents. We have updated it to highlight the changes made in CompCertO.</p>
<p>The archive includes a <code>compcerto.diff</code> file which lists our changes relative to CompCert v3.6, but for a more convenient experience you can clone our git repository and examine the version corresponding to our artifact (this has already been done in the VM image):</p>
<pre><code>$ git clone https://github.com/CertiKOS/compcert.git compcerto-gitclone
$ cd compcerto-gitclone/
$ git checkout compcerto-0.1</code></pre>
<p>You will then be able to display changes to individual files:</p>
<pre><code>$ git diff v3.6 common/Smallstep.v</code></pre>
<hr />
<h2 id="step-by-step-instructions">Step by Step Instructions</h2>
<p>Since our artifact is a Coq proof, we suggest the reviewers use the paper as a guide to the code. A copy of the paper is available in the virtual machine as <code>/home/aec/pldi21-paper596.pdf</code>, and we recommend browsing the code through the generated HTML files, starting with the overview given in <code>/home/aec/compcerto-prebuilt/doc/index.html</code>.</p>
<p>To help with the process, below we go through our various definitions and theorem and discuss the correspondence with the Coq development.</p>
<h3 id="operational-semantics-sec.-3">Operational semantics (Sec. 3)</h3>
<p>Sections 2 and 3 introduce our extended semantic model and our main results. They are implemented in Coq as follows.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Paper</th>
<th>File</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Def. 2.1</td>
<td>common/LanguageInterface.v</td>
<td><code>language_interface</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Def. 2.6</td>
<td>common/LanguageInterface.v</td>
<td><code>callconv</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Def. 3.1</td>
<td>common/Smallstep.v</td>
<td><code>lts</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Def. 3.2</td>
<td>common/SmallstepLinking.v</td>
<td><code>compose</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Def. 3.3</td>
<td>common/Smallstep.v</td>
<td><code>forward_simulation</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Thm. 3.4</td>
<td>common/SmallstepLinking.v</td>
<td><code>compose_simulation</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Thm. 3.5</td>
<td>x86/AsmLinking.v</td>
<td><code>asm_linking</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Def. 3.6</td>
<td>common/LanguageInterface.v</td>
<td><code>cc_compose</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Thm. 3.7</td>
<td>common/Smallstep.v</td>
<td><code>compose_forward_simulations</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Thm. 3.8</td>
<td>driver/Compiler.v</td>
<td><code>clight_semantic_preservation</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Cor. 3.9</td>
<td>driver/Compiler.v</td>
<td><code>compose_transf_c_program_correct</code></td>
</tr>
</tbody>
</table>
<p>The Kleene algebra mentioned at the end of Section 3.3 is formalized in common/CallconvAlgebra.v. The memory model used in CompCert (Figure 4) is formalized in common/Memory.v.</p>
<p>The language interfaces used for various languages (Table 2) can be found in the following files.</p>
<table>
<thead>
<tr class="header">
<th>L.I.</th>
<th>File</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>C</td>
<td>common/LanguageInterface.v</td>
<td><code>li_c</code></td>
</tr>
<tr class="even">
<td>L</td>
<td>backend/Conventions.v</td>
<td><code>li_locset</code></td>
</tr>
<tr class="odd">
<td>M</td>
<td>backend/Mach.v</td>
<td><code>li_mach</code></td>
</tr>
<tr class="even">
<td>A</td>
<td>x86/Asm.v</td>
<td><code>li_asm</code></td>
</tr>
<tr class="odd">
<td>1</td>
<td>common/LanguageInterface.v</td>
<td><code>li_null</code></td>
</tr>
<tr class="even">
<td>W</td>
<td>common/LanguageInterface.v</td>
<td><code>li_wp</code></td>
</tr>
</tbody>
</table>
<p>The correctness proofs for the various compilation passes (Table 3) can be found in the subdirectories <code>cfrontend/</code>, <code>backend/</code> and <code>x86/</code>, depending on the pass. For the pass FooBar, the proof will be in file named <code>FooBarproof.v</code>; usually the main simulation theorem is located at the end of the file.</p>
<p>Note that there are minor differences between the paper and the artifact in the specific language interfaces and simulation conventions used for some languages and passes. See also our discussion of Section 5 below.</p>
<h3 id="logical-relations-for-compcert-sec.-4">Logical relations for CompCert (Sec. 4)</h3>
<p>The theory of CompCert Kripke logical relations (CKLRs) is formalized in the <code>cklr/</code> subdirectory, new in CompCertO. To automate relational reasoning, we are using the <a href="http://certikos.github.io/coqrel/">Coqrel</a> library, included in the source under the <code>coqrel/</code> subdirectory.</p>
<p>The definition of CKLR (Section 4.4, Figure 6) is found in cklr/CKLR.v. The basic theory is developed further in cklr/CKLRAlgebra.v.</p>
<p>We then defines a number of specific CKLRs, used to formulate the simulation convention for various passes and to derive the compiler’s overall convention:</p>
<table>
<thead>
<tr class="header">
<th>CKLR</th>
<th>File</th>
<th>See also</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ext</td>
<td>cklr/Extends.v</td>
<td>Sec 4.1</td>
</tr>
<tr class="even">
<td>inj</td>
<td>cklr/Inject.v</td>
<td>Sec 4.2</td>
</tr>
<tr class="odd">
<td>injp</td>
<td>cklr/InjectFootprint.v</td>
<td>Sec 4.5</td>
</tr>
<tr class="even">
<td>vaext</td>
<td>cklr/VAExtends.v</td>
<td></td>
</tr>
<tr class="odd">
<td>vainj</td>
<td>cklr/VAInject.v</td>
<td></td>
</tr>
</tbody>
</table>
<p>As described in Section 4.4 under <em>Simulation conventions</em>, CKLRs can be promoted to simulation conventions for various language interfaces:</p>
<table>
<thead>
<tr class="header">
<th>L.I.</th>
<th>File</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>C</td>
<td>common/LanguageInterface.v</td>
<td><code>cc_c</code></td>
</tr>
<tr class="even">
<td>L</td>
<td>backend/Conventions.v</td>
<td><code>cc_locset</code></td>
</tr>
<tr class="odd">
<td>M</td>
<td>backend/Mach.v</td>
<td><code>cc_mach</code></td>
</tr>
<tr class="even">
<td>A</td>
<td>x86/Asm.v</td>
<td><code>cc_asm</code></td>
</tr>
</tbody>
</table>
<p>These conventions can then be used to express parametricity theorems for various languages (Theorem 4.3):</p>
<table>
<thead>
<tr class="header">
<th>Language</th>
<th>File</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Clight</td>
<td>cklr/Clightrel.v</td>
<td><code>semantics1_rel</code></td>
</tr>
<tr class="even">
<td>RTL</td>
<td>cklr/RTLrel.v</td>
<td><code>semantics_rel</code></td>
</tr>
<tr class="odd">
<td>Asm</td>
<td>x86/Asmrel.v</td>
<td><code>semantics_asm_rel</code></td>
</tr>
</tbody>
</table>
<h3 id="calling-convention-sec.-5">Calling convention (Sec. 5)</h3>
<p>Compared with the paper, the artifact includes improvements to the way we derive the compiler’s overall simulation convention from the simulation convention of each pass. While the general idea remains the same, the approach implemented in this version of CompCertO is more systematic and uniform. We indent to update our paper to describe these changes.</p>
<p>Our approach is described in detail in the file driver/CallConv.v. The main simulation conventions involved are the following:</p>
<table>
<thead>
<tr class="header">
<th>Sim. Conv.</th>
<th>File</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CL</td>
<td>backend/Conventions.v</td>
<td><code>cc_c_locset</code></td>
</tr>
<tr class="even">
<td>LM</td>
<td>driver/CallConv.v</td>
<td><code>cc_locset_mach</code></td>
</tr>
<tr class="odd">
<td>MA</td>
<td>x86/Asm.v</td>
<td><code>cc_mach_asm</code></td>
</tr>
<tr class="even">
<td>wt</td>
<td>common/Invariant.v</td>
<td><code>wt_c</code></td>
</tr>
<tr class="odd">
<td>va</td>
<td>backend/ValueAnalysis.v</td>
<td><code>vamatch</code></td>
</tr>
<tr class="even">
<td>ℂ</td>
<td>driver/Compiler.v</td>
<td><code>cc_compcert</code></td>
</tr>
</tbody>
</table>
<p>The main result established in CallConv.v, and used in Compiler.v to derive our final correctness theorem, is that CKLRs can commute over the simulation conventions CL, LM, MA. This allows the incoming Asm-level injection to be expanded and propagated to match the incoming requirements of the various passes, and outgoing CKLRs to be propagated to the source level where the can be matched by the Kleene star component of the overall simulation convention.</p>
<p>Because CKLRs do not commute in the <strong>va</strong> invariant in the same way, we have defined the CKLRs <strong>vaext</strong> and <strong>vainj</strong> which enforce this invariant on their source memory states.</p>
<h3 id="evaluation-sec.-6">Evaluation (Sec. 6)</h3>
<p>To obtain the numbers reported in Table 3 and Table 5, we used the script <code>overhead.py</code> included at the root of our development. The script will only function in a git repository (<code>/home/aec/compcerto-gitclone/</code> in the VM). <code>overhead.py</code> uses <code>coqwc</code> to compare the lines of specifications, proofs, and both in the currently checked out version, vs. the <code>origin/compcerto-ref</code> branch found in our github repository.</p>
<p>In CompCertO, some of the code in backend/Cminor.v is unused and has been commented out. To avoid <code>coqwc</code> reporting an artificial decrease in the SLOCs for that file, we have made the same modification in the <code>compcerto-ref</code> branch, which is otherwise identical to CompCert v3.6.</p>
<p>To run the script, use the following command:</p>
<pre><code>$ python3 overhead.py</code></pre>
<p>The numbers we used in the paper were approximative and correspond to a previous version of our development based on CompCert v3.5. Because of the changes described in the previous section and our upgrade to CompCert v3.6, the numbers reported are now slightly different from those in the submitted paper, however they remain commensurable. We will update our final paper with up-to-date numbers.</p>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>Thank you for evaluating our CompCertO artifact!</p>
</body>
</html>
